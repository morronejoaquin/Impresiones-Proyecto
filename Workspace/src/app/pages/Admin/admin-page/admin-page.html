<div class="admin-page">

  <div class="buttons">
    <button class="price-admin-button" (click)="goToPriceAdmin()">Administrar Precios</button>
    <button class="record-admin-button" (click)="goToRecordAdmin()">Ver historial</button>
  </div>
  
  <!-- FILTROS -->
  <div class="filters">
    <label>
      Filtrar por Status:
      <select [(ngModel)]="filterStatus" (change)="filterByStatus()">
        <option value="">Todos</option>
        <option value="pending">Pending</option>
        <option value="printing">Printing</option>
        <option value="binding">Binding</option>
        <option value="ready">Ready</option>
        <option value="delivered">Delivered</option>
        <option value="cancelled">Cancelled</option>
      </select>
    </label>

    <label>
      Filtrar por Apellido:
      <input type="text" [(ngModel)]="filterSurname" (input)="filterBySurname()" placeholder="Escriba apellido">
    </label>

    <button (click)="clearFilters()">Limpiar filtros</button>
  </div>

  @if (filteredCarts.length === 0) {
    <p>No hay pedidos pendientes</p>
  } @else {
    <div class="carts">
      @for (cart of filteredCarts; track cart.id) {
        <div class="cart" (click)="goToDetail(cart)">

          <!-- Encabezado: estado + situación + fecha -->
          <div class="cart-header">
            <div class="cart-status">
              <span>{{ cart.status }}</span>
            </div>

            <div class="cart-situacion">
              @if(cart.status === 'ready'){
                <span>Listo para entregar</span>
              }
            </div>

            <div class="cart-fecha">
              <span class="fecha-label">Fecha:</span>
              <span class="fecha-value">
                {{ cart.completedAt ? (cart.completedAt | date:'dd/MM/yyyy HH:mm') : '—' }}
              </span>
            </div>
          </div>

          <div class="cart-resumen">
            <p>Cliente:</p>
            <p>{{ cart.customer?.name }} {{ cart.customer?.surname }}</p>
          </div>

          <div class="cart-archivos">
            <p>Archivos:</p>
            <p>{{ cart.fileSummary }}</p>
            <p>{{ cart.orderItems.length }} items en total</p>
          </div>

          <div class="cart-total">
            <p>Total:</p>
            <p>${{ cart.total | number:'1.2-2' }}</p>
          </div>

          <div class="cart-actions" (click)="$event.stopPropagation()">
            <label>
              Estado:
              <select
                [ngModel]="cart.status"
                (ngModelChange)="updateStatus(cart, $event)"
                [disabled]="savingIds.has(cart.id)">
                <option *ngFor="let s of STATUSES" [value]="s">{{ s }}</option>
              </select>
            </label>
            <span *ngIf="savingIds.has(cart.id)" style="opacity:.7">Guardando…</span>
          </div>

        </div>
      }
    </div>
  }
</div>
